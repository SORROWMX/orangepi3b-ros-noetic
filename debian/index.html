<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROS Noetic Packages - Debian Repository</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
        }
        
        .header p {
            margin: 10px 0 0 0;
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
        
        .search-container {
            margin-bottom: 30px;
        }
        
        .search-box {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
        }
        
        .search-box:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .package-list {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .package-item {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s;
        }
        
        .package-item:hover {
            background-color: #f8f9fa;
        }
        
        .package-item:last-child {
            border-bottom: none;
        }
        
        .package-name {
            font-weight: 500;
            color: #333;
        }
        
        .package-description {
            color: #666;
            font-size: 0.85em;
            margin: 2px 0;
            font-style: italic;
        }
        
        .package-size {
            color: #666;
            font-size: 0.9em;
        }
        
        .package-link {
            color: #667eea;
            text-decoration: none;
            padding: 5px 10px;
            border: 1px solid #667eea;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .package-link:hover {
            background-color: #667eea;
            color: white;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .error {
            background-color: #ffebee;
            color: #c62828;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .category-filter {
            margin-bottom: 20px;
        }
        
        .category-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .category-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .category-btn:hover,
        .category-btn.active {
            background-color: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #666;
            border-top: 1px solid #eee;
        }
        
        .tutorial-section {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .tutorial-section h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .tutorial-steps {
            margin-bottom: 30px;
        }
        
        .step {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .step h3 {
            margin: 0 0 15px 0;
            color: #333;
        }
        
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            position: relative;
            overflow-x: auto;
        }
        
        .code-block code {
            background: none;
            color: inherit;
            padding: 0;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #667eea;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background-color 0.2s;
        }
        
        .copy-btn:hover {
            background: #5a67d8;
        }
        
        .copy-btn.copied {
            background: #48bb78;
        }
        
        .tutorial-note {
            background: #e6fffa;
            border: 1px solid #81e6d9;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .tutorial-note h4 {
            margin: 0 0 10px 0;
            color: #234e52;
        }
        
        .tutorial-note p {
            margin: 0 0 15px 0;
            color: #234e52;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ðŸ¤– ROS Noetic Packages</h1>
        <p>Debian Repository for Orange Pi 3B (ARM64)</p>
    </div>
    
    <div class="tutorial-section">
        <h2>ðŸ“‹ Repository Setup Tutorial</h2>
        <div class="tutorial-steps">
            <div class="step">
                <h3>Step 1: Add GPG Key</h3>
                <div class="code-block">
                    <code>wget -qO - https://sorrowmx.github.io/orangepi3b-ros-noetic/public-key.asc | sudo apt-key add -</code>
                    <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                </div>
            </div>
            
            <div class="step">
                <h3>Step 2: Add Repository</h3>
                <div class="code-block">
                    <code>echo "deb [trusted=yes] https://sorrowmx.github.io/orangepi3b-ros-noetic/debian/ /" | sudo tee /etc/apt/sources.list.d/ros-noetic-orangepi.list</code>
                    <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                </div>
            </div>
            
            <div class="step">
                <h3>Step 3: Update Package List</h3>
                <div class="code-block">
                    <code>sudo apt update</code>
                    <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                </div>
            </div>
            
            <div class="step">
                <h3>Step 4: Install ROS Packages</h3>
                <div class="code-block">
                    <code>sudo apt install ros-noetic-ros-core ros-noetic-ros-base</code>
                    <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                </div>
            </div>
        </div>
        
        <div class="tutorial-note">
            <h4>ðŸ’¡ Alternative: Manual Installation</h4>
            <p>You can also download individual .deb files from the list below and install them manually:</p>
            <div class="code-block">
                <code>sudo dpkg -i *.deb && sudo apt-get install -f</code>
                <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
            </div>
        </div>
    </div>
    
    <div class="stats">
        <div class="stat-card">
            <div class="stat-number" id="total-packages">-</div>
            <div class="stat-label">Total Packages</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="core-packages">-</div>
            <div class="stat-label">Core Packages</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="debug-packages">-</div>
            <div class="stat-label">Debug Symbols</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="total-size">-</div>
            <div class="stat-label">Total Size</div>
        </div>
    </div>
    
    <div class="search-container">
        <input type="text" class="search-box" id="searchBox" placeholder="Search packages...">
    </div>
    
    <div class="category-filter">
        <div class="category-buttons">
            <button class="category-btn active" data-category="all">All</button>
            <button class="category-btn" data-category="core">Core</button>
            <button class="category-btn" data-category="communication">Communication</button>
            <button class="category-btn" data-category="messages">Messages</button>
            <button class="category-btn" data-category="tf">Transform</button>
            <button class="category-btn" data-category="image">Image</button>
            <button class="category-btn" data-category="utilities">Utilities</button>
            <button class="category-btn" data-category="debug">Debug</button>
        </div>
    </div>
    
    <div class="package-list" id="packageList">
        <div class="loading">Loading packages...</div>
    </div>
    
    <div class="footer">
        <p>Generated automatically by GitHub Actions | Last updated: <span id="lastUpdated">-</span></p>
    </div>

    <script>
        let allPackages = [];
        let filteredPackages = [];
        
        // Load packages from the repository
        async function loadPackages() {
            try {
                // First try to load from packages.json (more reliable)
                const jsonResponse = await fetch('./packages.json');
                if (jsonResponse.ok) {
                    const data = await jsonResponse.json();
                    allPackages = data.packages.map(pkg => ({
                        name: pkg.name,
                        url: pkg.url,
                        size: pkg.size,
                        category: pkg.category,
                        description: pkg.description
                    }));
                    
                    filteredPackages = [...allPackages];
                    updateStats();
                    renderPackages();
                    updateLastUpdated();
                    return;
                }
                
                // Fallback: try to load from directory listing
                const response = await fetch('./pool/main/arm64/');
                const html = await response.text();
                
                // Parse the directory listing to extract .deb files
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const links = doc.querySelectorAll('a[href$=".deb"]');
                
                if (links.length > 0) {
                    allPackages = Array.from(links).map(link => {
                        const href = link.getAttribute('href');
                        const text = link.textContent.trim();
                        const size = link.nextSibling ? link.nextSibling.textContent.trim() : '';
                        
                        return {
                            name: text,
                            url: href,
                            size: size,
                            category: categorizePackage(text)
                        };
                    });
                    
                    filteredPackages = [...allPackages];
                    updateStats();
                    renderPackages();
                    updateLastUpdated();
                } else {
                    throw new Error('No packages found in directory');
                }
                
            } catch (error) {
                console.error('Error loading packages:', error);
                document.getElementById('packageList').innerHTML = 
                    '<div class="error">Error loading packages. Please try again later.</div>';
            }
        }
        
        // Categorize packages based on name
        function categorizePackage(name) {
            const lowerName = name.toLowerCase();
            
            if (lowerName.includes('ros-core') || lowerName.includes('ros-base') || 
                lowerName.includes('ros-comm') || lowerName.includes('ros_')) {
                return 'core';
            } else if (lowerName.includes('roscpp') || lowerName.includes('rospy') || 
                       lowerName.includes('rosgraph') || lowerName.includes('rosmaster')) {
                return 'communication';
            } else if (lowerName.includes('msgs') && !lowerName.includes('dbgsym')) {
                return 'messages';
            } else if (lowerName.includes('tf') && !lowerName.includes('dbgsym')) {
                return 'tf';
            } else if (lowerName.includes('image') || lowerName.includes('camera') || 
                       lowerName.includes('opencv')) {
                return 'image';
            } else if (lowerName.includes('rosbag') || lowerName.includes('roslaunch') || 
                       lowerName.includes('roswtf')) {
                return 'utilities';
            } else if (lowerName.includes('dbgsym')) {
                return 'debug';
            }
            
            return 'other';
        }
        
        // Update statistics
        function updateStats() {
            const total = allPackages.length;
            const core = allPackages.filter(p => p.category === 'core').length;
            const debug = allPackages.filter(p => p.category === 'debug').length;
            
            // Calculate total size (simplified)
            const totalSize = allPackages.reduce((sum, pkg) => {
                const sizeStr = pkg.size.replace(/[^\d.]/g, '');
                const size = parseFloat(sizeStr) || 0;
                return sum + size;
            }, 0);
            
            document.getElementById('total-packages').textContent = total;
            document.getElementById('core-packages').textContent = core;
            document.getElementById('debug-packages').textContent = debug;
            document.getElementById('total-size').textContent = formatSize(totalSize);
        }
        
        // Format file size
        function formatSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }
        
        // Render packages
        function renderPackages() {
            const container = document.getElementById('packageList');
            
            if (filteredPackages.length === 0) {
                container.innerHTML = '<div class="loading">No packages found.</div>';
                return;
            }
            
            const html = filteredPackages.map(pkg => `
                <div class="package-item">
                    <div>
                        <div class="package-name">${pkg.name}</div>
                        ${pkg.description ? `<div class="package-description">${pkg.description}</div>` : ''}
                        <div class="package-size">${pkg.size}</div>
                    </div>
                    <a href="./pool/main/arm64/${pkg.url}" class="package-link" download>Download</a>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }
        
        // Filter packages
        function filterPackages() {
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();
            const activeCategory = document.querySelector('.category-btn.active').dataset.category;
            
            filteredPackages = allPackages.filter(pkg => {
                const matchesSearch = pkg.name.toLowerCase().includes(searchTerm);
                const matchesCategory = activeCategory === 'all' || pkg.category === activeCategory;
                return matchesSearch && matchesCategory;
            });
            
            renderPackages();
        }
        
        // Update last updated time
        function updateLastUpdated() {
            const now = new Date();
            document.getElementById('lastUpdated').textContent = now.toLocaleString();
        }
        
        // Event listeners
        document.getElementById('searchBox').addEventListener('input', filterPackages);
        
        document.querySelectorAll('.category-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                filterPackages();
            });
        });
        
        // Copy to clipboard function
        function copyToClipboard(button) {
            const codeBlock = button.parentElement;
            const code = codeBlock.querySelector('code').textContent;
            
            navigator.clipboard.writeText(code).then(() => {
                button.textContent = 'Copied!';
                button.classList.add('copied');
                setTimeout(() => {
                    button.textContent = 'Copy';
                    button.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy: ', err);
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = code;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                button.textContent = 'Copied!';
                button.classList.add('copied');
                setTimeout(() => {
                    button.textContent = 'Copy';
                    button.classList.remove('copied');
                }, 2000);
            });
        }
        
        // Load packages when page loads
        loadPackages();
    </script>
</body>
</html>

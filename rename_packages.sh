#!/bin/bash

# üîÑ –°–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –ø–∞–∫–µ—Ç–æ–≤ –¥–ª—è Debian Bookworm
# –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ—Ç –ø–∞–∫–µ—Ç—ã —Å -0focal –Ω–∞ -0bookworm

echo "üîÑ –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤ –¥–ª—è Debian Bookworm..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ .deb —Ñ–∞–π–ª–æ–≤
if [ ! -f *.deb ]; then
    echo "‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω–æ .deb —Ñ–∞–π–ª–æ–≤ –≤ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏"
    exit 1
fi

# –°–æ–∑–¥–∞–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
echo "üìÅ –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏..."
mkdir -p backup_original
cp *.deb backup_original/ 2>/dev/null
echo "‚úÖ –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å–æ–∑–¥–∞–Ω–∞ –≤ backup_original/"

# –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Ñ–∞–π–ª—ã –¥–ª—è –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è
focal_count=$(ls *-0focal*.deb 2>/dev/null | wc -l)
echo "üìä –ù–∞–π–¥–µ–Ω–æ $focal_count –ø–∞–∫–µ—Ç–æ–≤ —Å —Å—É—Ñ—Ñ–∏–∫—Å–æ–º -0focal"

if [ $focal_count -eq 0 ]; then
    echo "‚ÑπÔ∏è –ù–µ—Ç –ø–∞–∫–µ—Ç–æ–≤ –¥–ª—è –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è"
    exit 0
fi

# –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ–º —Ñ–∞–π–ª—ã
echo "üîÑ –ù–∞—á–∏–Ω–∞–µ–º –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ..."
renamed_count=0

for file in *-0focal*.deb; do
    if [ -f "$file" ]; then
        new_name=$(echo "$file" | sed 's/-0focal/-0bookworm/g')
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–≤—ã–π —Ñ–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        if [ -f "$new_name" ]; then
            echo "‚ö†Ô∏è –§–∞–π–ª $new_name —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º $file"
            continue
        fi
        
        mv "$file" "$new_name"
        echo "‚úÖ Renamed: $file -> $new_name"
        ((renamed_count++))
    fi
done

# –£–¥–∞–ª—è–µ–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è focal —Ñ–∞–π–ª—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)
echo ""
echo "üóëÔ∏è –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Å—Ç–∞—Ä—ã—Ö focal —Ñ–∞–π–ª–æ–≤..."
remaining_focal=$(ls *-0focal*.deb 2>/dev/null | wc -l)
if [ $remaining_focal -gt 0 ]; then
    echo "–ù–∞–π–¥–µ–Ω–æ $remaining_focal —Å—Ç–∞—Ä—ã—Ö focal —Ñ–∞–π–ª–æ–≤ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:"
    for file in *-0focal*.deb; do
        if [ -f "$file" ]; then
            rm "$file"
            echo "üóëÔ∏è –£–¥–∞–ª–µ–Ω: $file"
        fi
    done
else
    echo "‚ÑπÔ∏è –°—Ç–∞—Ä—ã—Ö focal —Ñ–∞–π–ª–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ"
fi

echo ""
echo "üéâ –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
echo "üìä –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–æ —Ñ–∞–π–ª–æ–≤: $renamed_count –∏–∑ $focal_count"
echo "üìÅ –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ backup_original/"

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
echo ""
echo "üìã –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–∞–∫–µ—Ç–æ–≤:"
echo "   - –í—Å–µ–≥–æ .deb —Ñ–∞–π–ª–æ–≤: $(ls *.deb 2>/dev/null | wc -l)"
echo "   - –° —Å—É—Ñ—Ñ–∏–∫—Å–æ–º -0bookworm: $(ls *-0bookworm*.deb 2>/dev/null | wc -l)"
echo "   - –° —Å—É—Ñ—Ñ–∏–∫—Å–æ–º -0focal: $(ls *-0focal*.deb 2>/dev/null | wc -l)"

# –°–æ–∑–¥–∞–µ–º –æ—Ç—á–µ—Ç
echo ""
echo "üìù –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞..."
cat > rename_report.txt << EOF
–û—Ç—á–µ—Ç –æ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–∏ –ø–∞–∫–µ—Ç–æ–≤
–î–∞—Ç–∞: $(date)
–ò—Å—Ö–æ–¥–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤ —Å -0focal: $focal_count
–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–æ —Ñ–∞–π–ª–æ–≤: $renamed_count
–û—à–∏–±–æ–∫: $((focal_count - renamed_count))

–°–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:
$(ls *-0bookworm*.deb 2>/dev/null | head -10)
$(if [ $(ls *-0bookworm*.deb 2>/dev/null | wc -l) -gt 10 ]; then echo "... –∏ –µ—â–µ $(($(ls *-0bookworm*.deb 2>/dev/null | wc -l) - 10)) —Ñ–∞–π–ª–æ–≤"; fi)
EOF

echo "üìÑ –û—Ç—á–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ rename_report.txt"
echo ""
echo "‚úÖ –ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞–∫–µ—Ç—ã —Å Debian Bookworm"
